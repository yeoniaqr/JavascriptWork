<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>[Object(객체)] 05.객체를-JSON으로-변환하기.html</title>

</head>

<body>
  <header>
    <h2>[Object(객체)] 05.객체를 JSON으로 변환하기</h2>
    <p>
      1. JSON.stringify() 함수 <br />
      2. 특정 항목만 JSON으로 변환하기<br />
      3. 들여쓰기(indent) 설정하기
    </p>
  </header>

  <script>
    /*---------------------------------------------------------------------
      1. JSON.stringify() 함수
          JSON.stringify(value[, replacer[, space]])
          
          JSON.stringify() 함수는 Javascript의 값이나 객체를 JSON 문자열로 변환

          value (필수) - json 문자열로 변환할 값 또는 객체
          replacer(optional) - json 변경 규칙을 정의 할 함수 또는 json에 포함 될 프로퍼티(속성)을 가지는 배열
          space(optional) - 들여쓰기 공백 갯수 또는 문자열
    ---------------------------------------------------------------------*/

    const obj = {
      id: 123,
      product: {
        type: 'book',
        page: 200,
        title: 'Javascript',
        tags: ['JS', 'Beginner']
      }
    };

    const json = JSON.stringify(obj);
    // JSON.stringify() 함수를 이용하여 Javascript 객체를 JSON 형식의 문자열로 변환

    document.write(typeof obj + '<br>'); // object
    document.write(typeof json + '<br>'); // string
    document.write(json + '<br>');

    /*
      json형식의 특징!!!!!!!!!!!!!!!
        - 문자열을 감쌀 때 쌍따옴표("")를 사용
        - 프로퍼티 키(property key)는 쌍따옴표("")로 감싸져야 한다.
        - 주석을 작성할 수 없다.
    */


    /*---------------------------------------------------------------------
      JSON.stringify() 함수로 변환되지 않는 항목
    ---------------------------------------------------------------------*/
    const obj2 = {
      x: undefined,
      y: Symbol(''),
      z: function () {
        alert('Hi')
      },
      arr: [
        1,
        undefined,
        Symbol(''),
        function () { alert('Hi') }
      ]
    };

    const json2 = JSON.stringify(obj2);

    document.write(json2); // {"arr":[1,null,null,null]}

    // JSON.stringify() 함수로 객체를 JSON 형태의 문자열로 변환할 때
    // undefined, Symbol, function은 변환되지 않고 무시된다.
    // 만약, undefined, Symbol, function이 배열 안에 있다면 이 값들은 null로 전환되어 표시

    /*---------------------------------------------------------------------
      2. 특정 항목만 JSON으로 변환하기
        replacer
        SON.stringify() 함수는 두번째 파라미터로 replacer를 받는다.
        이 값은 배열이 될 수도 있고, 함수가 될 수도 있다.
        이 replacer를 이용하여, Javascript 객체에서 JSON 문자열로 변환 할 property(속성)을 지정
    ---------------------------------------------------------------------*/

    // replacer가 배열인 경우

    // 배열 replacer 예제 1. --------------------------------------------
    const obj3 = {
      x: 'x',
      y: 'y',
      z: {
        z1: 'z1'
      }

    };

    const json3 = JSON.stringify(obj3, ['y', 'z']);

    document.write(json3); // {"y":"y","z":{}}
    // 'y', 'z' 2개의 속성만을 JSON으로 변환
    // 그런데, 'z' 속성이 가지고 있는 객체에 포함 된 'z1'은 제대로 변환되지 않았다.
    // 'z1' 속성도 JSON 문자열에 포함시키고 싶다면, 다음과 같이 'z1'도 replacer 배열에 포함시켜줘야된다.


    // 배열 replacer 예제 2. --------------------------------------------
    const obj4 = {
      x: 'x',
      y: 'y',
      z: {
        z1: 'z1'
      }

    };

    const json4 = JSON.stringify(obj4, ['y', 'z', 'z1']);

    document.write(json4); // {"y":"y","z":{"z1":"z1"}}
    //'z1'도 배열에 포함시키니, 'z' 속성의 값인 객체('z1'을 포함하고 있는)도 JSON 문자열로 변환


    // replacer가 함수인 경우
    // replacer는 함수가 될 수도 있다. JSON으로 변환할 속성을 일일히 나열하기 힘들 다거나, 특별한 조건을 주어야 할 때 유용하다.

    // 함수 replacer 예제 1. JSON으로 변환할 항목 선택하기 --------------------------------
    const obj5 = {
      x: 'x',
      y: 'y',
      z: {
        z1: 'z1'
      }
    };

    function replacer(key, value) {
      document.write(key + " : " + value + '<br>');
      // replacer가 함수일 때는, 파라미터로 객체의 key와 value가 전달된다.
      // 위 코드에서 replacer 함수로 전달된 객체의 모든 key와 value가 출력되는 것을 확인 할 수 있음
      // (가장 먼저 찍히는 ': [object Object]'는 JSON으로 변환할 'obj' 객체를 가리킵니다.)

      //replacer 함수에서 undefined를 반환하면 해당 속성은 JSON으로 변환되지 않고 무시된다.
      // 위 예제에서 속성 'x'는 JSON 문자열에 포함시키지 않기 위해서 undefined를 리턴한다.

      if (key === 'x') {
        return undefined;
      } else {
        return value;
      }
    }

    const json5 = JSON.stringify(obj5, replacer);

    document.write('JSON : ' + json5);



    //  함수 replacer 예제 2. JSON으로 변환 시 속성 값 변경하기 --------------------------------
    const obj6 = {
      x: 1,
      y: 2
    };

    function replacer(key, value) {
      //위와 같이 replacer 함수를 작성하여, 객체를 JSON으로 변환할 때, 특정 속성의 값을 변경할 수 있다.
      if (key === 'x') {
        return value + 1;
        // 위 코드는 속성명이 'x'일 경우, 속성 'x'의 값에 1을 더하여서 리턴
      } else {
        return value;
      }
    }
    //  그리고, 생성된 JSON의 'x' 속성 값은 replacer 함수에서 변형하여 리턴한 '2'인 것을 확인 할 수 있다.

    const json6 = JSON6.stringify(obj6, replacer);

    document.write('JSON : ' + json6);


    /*---------------------------------------------------------------------
      3. 들여쓰기(indent) 설정하기
          JSON.stringify() 함수는 3번째 파라미터로 space를 입력 받는다.
          이 값은 숫자가 될 수도 있고, 문자열이 될 수도 있다.
          이 값을 이용해서 JSON 문자열의 들여쓰기 간격을 지정할 수 있다.
    ---------------------------------------------------------------------*/

    //  숫자로 space 지정하기 --------------------------------
    const obj7 = {
      x: 'x',
      y: 'y',
      z: {
        z1: 'z1'
      }
    };

    const json7 = JSON.stringify(obj7, null, 5);

    document.write('<pre>' + json7 + '</pre>');


    //  문자로 space 지정하기 --------------------------------
    const obj8 = {
      x: 'x',
      y: 'y',
      z: {
        z1: 'z1'
      }
    };

    const json8 = JSON.stringify(obj8, null, '**');

    document.write('<pre>' + json8 + '</pre>');
  </script>
</body>

</html>